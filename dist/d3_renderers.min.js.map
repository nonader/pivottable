{"version":3,"sources":["/source/d3_renderers.coffee","d3_renderers.min.js"],"names":["callWithJQuery","pivotModule","exports","module","require","define","amd","jQuery","$","pivotUtilities","d3_renderers","Treemap","pivotData","opts","addToTree","color","defaults","height","i","len","ref","result","rowKey","tree","treemap","value","width","localeStrings","d3","window","extend","css","name","children","path","child","newChild","x","length","shift","push","getRowKeys","getAggregator","scale","category10","layout","size","sticky","d","select","append","style","datum","selectAll","data","padding","nodes","enter","attr","text","call","this","y","Math","max","dx","dy"],"mappings":"CAAA,WAAA,GAAAA,IAAAA,EAAiB,SAACC,GACd,MAAqB,gBAAXC,UAAyC,gBAAVC,QACrCF,EAAYG,QAAQ,WACC,kBAAVC,SAAyBA,OAAOC,IAC3CD,QAAQ,UAAWJ,GAGnBA,EAAYM,UAEL,SAACC,GCKZ,MDHAA,GAAEC,eAAeC,cAAeC,QAAS,SAACC,EAAWC,GACjD,GAAAC,GAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,CAyBA,KAzBAV,GACIW,iBACAC,IACIF,MAAO,WCMT,MDNYlB,GAAEqB,QAAQH,QAAU,KAC9BT,OAAQ,WCQV,MDRaT,GAAEqB,QAAQZ,SAAW,OAExCJ,EAAOL,EAAEsB,OAAOd,EAAUH,GAG1BQ,EAASb,EAAE,SAASuB,KAAIL,MAAO,OAAQT,OAAQ,SAE/CM,GAAOS,KAAM,MAAOC,aACpBnB,EAAY,SAACS,EAAMW,EAAMT,GACrB,GAAAU,GAAAjB,EAAAC,EAAAiB,EAAAhB,EAAAiB,CAAA,IAAkB,IAAfH,EAAKI,OAEJ,YADAf,EAAKE,MAAQA,EAIjB,KCamB,MAAjBF,EAAKU,WDfPV,EAAKU,aACLI,EAAIH,EAAKK,QACTnB,EAAAG,EAAAU,SAAAf,EAAA,EAAAC,EAAAC,EAAAkB,OAAAnB,EAAAD,EAAAA,ICoBA,GADAiB,EAAQf,EAAIF,GDnBoBiB,EAAMH,OAAQK,EAE1C,WADAvB,GAAUqB,EAAOD,EAAMT,EC6B7B,OD3BEW,IAAWJ,KAAMK,GACjBvB,EAAUsB,EAAUF,EAAMT,GAC1BF,EAAKU,SAASO,KAAKJ,IAEvBhB,EAAAR,EAAA6B,aAAAvB,EAAA,EAAAC,EAAAC,EAAAkB,OAAAnB,EAAAD,EAAAA,IC2BEI,EAASF,EAAIF,GD1BXO,EAAQb,EAAU8B,cAAcpB,MAAYG,QACzC,MAAAA,GACCX,EAAUS,EAAMD,EAAQG,EA6BhC,OA3BAV,GAAQa,GAAGe,MAAMC,aACjBlB,EAAQb,EAAKe,GAAGF,QAChBT,EAASJ,EAAKe,GAAGX,SAEjBO,EAAUI,GAAGiB,OAAOrB,UACfsB,MAAMpB,EAAOT,IACb8B,QAAO,GACPtB,MAAO,SAACuB,GCyBX,MDzBiBA,GAAEF,OAErBlB,GAAGqB,OAAO5B,EAAO,IACZ6B,OAAO,OACHC,MAAM,WAAY,YAClBA,MAAM,QAASzB,EAAQ,MACvByB,MAAM,SAAUlC,EAAS,MAC7BmC,MAAM7B,GAAM8B,UAAU,SAClBC,KAAK9B,EAAQ+B,SAAS,GAAG,EAAE,EAAE,IAAI9B,MAAO,SAACuB,GCoBhD,MDpBsDA,GAAEvB,QAAQ+B,OAC7DC,QAAQP,OAAO,OACfQ,KAAK,QAAS,QACdP,MAAM,aAAc,SAACH,GAAM,MAAG,OAAAA,EAAAf,SAAiB,YAAiBlB,EAAMiC,EAAEhB,QACxE2B,KAAM,SAACX,GCwBV,MDxBgBA,GAAEhB,OACf4B,KAAK,WACEC,KAAKV,MAAM,OAAS,SAACH,GCyB7B,MDzBmCA,GAAEX,EAAE,OAC1Bc,MAAM,MAAS,SAACH,GC0B7B,MD1BmCA,GAAEc,EAAE,OAC1BX,MAAM,QAAS,SAACH,GC2B7B,MD3BmCe,MAAKC,IAAI,EAAGhB,EAAEiB,GAAK,GAAG,OAC5Cd,MAAM,SAAS,SAACH,GC4B7B,MD5BmCe,MAAKC,IAAI,EAAGhB,EAAEkB,GAAK,GAAG,SAGtD7C,QCiCZuC,KAAKC","file":"d3_renderers.min.js","sourcesContent":["callWithJQuery = (pivotModule) ->\r\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\r\n        pivotModule require(\"jquery\")\r\n    else if typeof define is \"function\" and define.amd # AMD\r\n        define [\"jquery\"], pivotModule\r\n    # Plain browser env\r\n    else\r\n        pivotModule jQuery\r\n        \r\ncallWithJQuery ($) ->\r\n\r\n    $.pivotUtilities.d3_renderers = Treemap: (pivotData, opts) ->\r\n        defaults =\r\n            localeStrings: {}\r\n            d3:\r\n                width: -> $(window).width() / 1.4\r\n                height: -> $(window).height() / 1.4\r\n\r\n        opts = $.extend defaults, opts\r\n\r\n\r\n        result = $(\"<div>\").css(width: \"100%\", height: \"100%\")\r\n\r\n        tree = name: \"All\", children: []\r\n        addToTree = (tree, path, value) ->\r\n            if path.length == 0\r\n                tree.value = value\r\n                return\r\n            tree.children ?= []\r\n            x = path.shift()\r\n            for child in tree.children when child.name == x\r\n                addToTree(child, path, value)\r\n                return\r\n            newChild = name: x\r\n            addToTree(newChild, path, value)\r\n            tree.children.push newChild\r\n\r\n        for rowKey in pivotData.getRowKeys()\r\n            value = pivotData.getAggregator(rowKey, []).value()\r\n            if value?\r\n                addToTree(tree, rowKey, value)\r\n\r\n        color = d3.scale.category10()\r\n        width = opts.d3.width()\r\n        height = opts.d3.height()\r\n\r\n        treemap = d3.layout.treemap()\r\n            .size([width, height])\r\n            .sticky(true)\r\n            .value( (d) -> d.size )\r\n\r\n        d3.select(result[0])\r\n            .append(\"div\")\r\n                .style(\"position\", \"relative\")\r\n                .style(\"width\", width + \"px\")\r\n                .style(\"height\", height + \"px\")\r\n            .datum(tree).selectAll(\".node\")\r\n                .data(treemap.padding([15,0,0,0]).value( (d) -> d.value ).nodes)\r\n            .enter().append(\"div\")\r\n            .attr(\"class\", \"node\")\r\n            .style(\"background\", (d) -> if d.children? then \"lightgrey\" else color(d.name) )\r\n            .text( (d) -> d.name )\r\n            .call ->\r\n                    this.style(\"left\",  (d) -> d.x+\"px\" )\r\n                        .style(\"top\",   (d) -> d.y+\"px\" )\r\n                        .style(\"width\", (d) -> Math.max(0, d.dx - 1)+\"px\" )\r\n                        .style(\"height\",(d) -> Math.max(0, d.dy - 1)+\"px\" )\r\n                    return\r\n        \r\n        return result\r\n    \r\n\r\n\r\n","(function(){var e;(e=function(e){return\"object\"==typeof exports&&\"object\"==typeof module?e(require(\"jquery\")):\"function\"==typeof define&&define.amd?define([\"jquery\"],e):e(jQuery)})(function(e){return e.pivotUtilities.d3_renderers={Treemap:function(t,n){var i,r,u,l,d,o,a,c,h,f,s,p,y;for(u={localeStrings:{},d3:{width:function(){return e(window).width()/1.4},height:function(){return e(window).height()/1.4}}},n=e.extend(u,n),c=e(\"<div>\").css({width:\"100%\",height:\"100%\"}),f={name:\"All\",children:[]},i=function(e,t,n){var r,u,l,d,o,a;if(0===t.length)return void(e.value=n);for(null==e.children&&(e.children=[]),a=t.shift(),o=e.children,u=0,l=o.length;l>u;u++)if(r=o[u],r.name===a)return void i(r,t,n);return d={name:a},i(d,t,n),e.children.push(d)},a=t.getRowKeys(),d=0,o=a.length;o>d;d++)h=a[d],p=t.getAggregator(h,[]).value(),null!=p&&i(f,h,p);return r=d3.scale.category10(),y=n.d3.width(),l=n.d3.height(),s=d3.layout.treemap().size([y,l]).sticky(!0).value(function(e){return e.size}),d3.select(c[0]).append(\"div\").style(\"position\",\"relative\").style(\"width\",y+\"px\").style(\"height\",l+\"px\").datum(f).selectAll(\".node\").data(s.padding([15,0,0,0]).value(function(e){return e.value}).nodes).enter().append(\"div\").attr(\"class\",\"node\").style(\"background\",function(e){return null!=e.children?\"lightgrey\":r(e.name)}).text(function(e){return e.name}).call(function(){this.style(\"left\",function(e){return e.x+\"px\"}).style(\"top\",function(e){return e.y+\"px\"}).style(\"width\",function(e){return Math.max(0,e.dx-1)+\"px\"}).style(\"height\",function(e){return Math.max(0,e.dy-1)+\"px\"})}),c}}})}).call(this);\n//# sourceMappingURL=d3_renderers.min.js.map"],"sourceRoot":"/source/"}