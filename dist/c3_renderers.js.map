{"version":3,"sources":["c3_renderers.coffee"],"names":[],"mappings":"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","file":"c3_renderers.js","sourceRoot":"/source/","sourcesContent":["callWithJQuery = (pivotModule) ->\r\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\r\n        pivotModule require(\"jquery\")\r\n    else if typeof define is \"function\" and define.amd # AMD\r\n        define [\"jquery\"], pivotModule\r\n    # Plain browser env\r\n    else\r\n        pivotModule jQuery\r\n        \r\ncallWithJQuery ($) ->\r\n\r\n    makeC3Chart = (chartOpts = {}) -> (pivotData, opts) ->\r\n        defaults =\r\n            localeStrings:\r\n                vs: \"vs\"\r\n                by: \"by\"\r\n            c3: {}\r\n\r\n        opts = $.extend true, defaults, opts\r\n        opts.c3.size ?= {}\r\n        opts.c3.size.width ?= window.innerWidth / 1.4\r\n        opts.c3.size.height ?= window.innerHeight / 1.4 - 50\r\n        chartOpts.type ?= \"line\"\r\n\r\n        rowKeys = pivotData.getRowKeys()\r\n        rowKeys.push [] if rowKeys.length == 0\r\n        colKeys = pivotData.getColKeys()\r\n        colKeys.push [] if colKeys.length == 0\r\n\r\n        headers = (h.join(\"-\") for h in colKeys)\r\n        rotationAngle = 0\r\n\r\n        fullAggName = pivotData.aggregatorName \r\n        if pivotData.valAttrs.length\r\n            fullAggName += \"(#{pivotData.valAttrs.join(\", \")})\"\r\n\r\n        if chartOpts.type == \"scatter\"\r\n            dataArray = []\r\n            hAxisTitle = pivotData.colAttrs.join(\"-\")\r\n            vAxisTitle = pivotData.rowAttrs.join(\"-\")\r\n            for y, tree2 of pivotData.tree\r\n                for x, agg of tree2\r\n                    datum = {}\r\n                    datum[hAxisTitle] = parseFloat(x)\r\n                    datum[vAxisTitle] = parseFloat(y)\r\n                    datum[\"tooltip\"] = agg.format(agg.value())\r\n                    dataArray.push datum\r\n        else\r\n            numCharsInHAxis = 0\r\n            for x in headers\r\n                numCharsInHAxis += x.length\r\n            if numCharsInHAxis > 50\r\n                rotationAngle = 45\r\n\r\n            columns = []\r\n            for rowKey in rowKeys\r\n                rowHeader = rowKey.join(\"-\")\r\n                row = [if rowHeader == \"\" then pivotData.aggregatorName else rowHeader]\r\n                for colKey in colKeys\r\n                    agg = pivotData.getAggregator(rowKey, colKey)\r\n                    if agg.value()?\r\n                        val = agg.value()\r\n                        if $.isNumeric val\r\n                            if val < 1\r\n                                row.push parseFloat(val.toPrecision(3))\r\n                            else\r\n                                row.push parseFloat(val.toFixed(3))\r\n                        else\r\n                            row.push val\r\n\r\n                    else row.push null\r\n                columns.push row\r\n\r\n            vAxisTitle = pivotData.aggregatorName+ \r\n                if pivotData.valAttrs.length then \"(#{pivotData.valAttrs.join(\", \")})\" else \"\"\r\n            hAxisTitle = pivotData.colAttrs.join(\"-\")\r\n\r\n        titleText = vAxisTitle = fullAggName\r\n        titleText += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\r\n        groupByTitle = pivotData.rowAttrs.join(\"-\")\r\n        titleText += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\r\n        title = $(\"<p>\", {style: \"text-align: center; font-weight: bold\"})\r\n        title.text(titleText)\r\n\r\n        params = \r\n            axis: \r\n                y:\r\n                    label: vAxisTitle\r\n                x:\r\n                    label: hAxisTitle\r\n                    tick:\r\n                        rotate: rotationAngle\r\n                        multiline: false\r\n            data: \r\n                type: chartOpts.type\r\n            tooltip:\r\n                grouped: false\r\n\r\n        $.extend params, opts.c3\r\n\r\n        if chartOpts.type == \"scatter\"\r\n            params.data.x = hAxisTitle\r\n            params.axis.x.tick = fit: false\r\n            params.data.json = dataArray\r\n            params.data.keys = value: [hAxisTitle,vAxisTitle]\r\n            params.legend = show: false \r\n            params.tooltip.format =  \r\n                title: -> fullAggName\r\n                name: -> \"\"\r\n                value: (a,b,c,d) -> dataArray[d].tooltip\r\n        else\r\n            params.axis.x.type= 'category'\r\n            params.axis.x.categories = headers\r\n            params.data.columns = columns\r\n\r\n\r\n        if chartOpts.stacked?\r\n            params.data.groups = [x.join(\"-\") for x in rowKeys]\r\n        renderArea = $(\"<div>\", style: \"display:none;\").appendTo $(\"body\")\r\n        result = $(\"<div>\").appendTo renderArea\r\n        params.bindto = result[0]\r\n        c3.generate params\r\n        result.detach()\r\n        renderArea.remove()\r\n        return $(\"<div>\").append title, result\r\n\r\n    $.pivotUtilities.c3_renderers = \r\n        \"Line Chart\": makeC3Chart()\r\n        \"Bar Chart\": makeC3Chart(type: \"bar\")\r\n        \"Stacked Bar Chart\": makeC3Chart(type: \"bar\", stacked: true)\r\n        \"Area Chart\": makeC3Chart(type: \"area\", stacked: true)\r\n        \"Scatter Chart\": makeC3Chart(type: \"scatter\")\r\n"]}